<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Watch Movie</title>
  <!-- Video.js CSS -->
  <link href="https://vjs.zencdn.net/8.0.4/video-js.css" rel="stylesheet">
  <!-- Video.js JavaScript -->
  <script src="https://vjs.zencdn.net/8.0.4/video.min.js"></script>
  <!-- YouTube Plugin -->
  <script src="https://unpkg.com/videojs-youtube/dist/Youtube.min.js"></script>
</head>
<body>
  <header class="navBar">
    <img src="kimiihorror.png" alt="website logo" width="250px">
    <nav class="header">
      <a href="index.html">Home</a>
      <a href="watchlist.html">Watchlist</a>
    </nav>
  </header>

  <main>
    <!-- Movie Name as the Page Header -->
    <section id="movie-header">
      <h1 id="movie-title">Loading...</h1>
    </section>

    <!-- Breadcrumbs -->
    <nav id="breadcrumbs">
      <a href="index.html">Home</a> > <span id="breadcrumb-movie-name">Loading...</span>
    </nav>

    <!-- Video Player -->
    <section id="video-section">
      <div id="video-container">
        <!-- The video will be loaded here -->
      </div>
    </section>

    <!-- Movie Description -->
    <section id="movie-details">
      <h2>Description</h2>
      <p id="movie-description">Loading movie description...</p>
    </section>

    <!-- Recommended Movies -->
    <section id="recommended-movies">
      <h2>Recommended Movies</h2>
      <div class="recommended-grid" id="recommended-grid">
        <!-- Recommended movies will be dynamically populated -->
      </div>
    </section>
  </main>

  <footer>
    <div class="footer-left">
      <img src="kimiihorror.png" alt="Kimii Horror Logo" class="kimii" width="150px">
      <p class="copy">Â© Kimii Horror 2024</p>
    </div>
  </footer>

  <script>
    // Retrieve the current movie from localStorage
    const currentMovie = JSON.parse(localStorage.getItem('currentMovie'));
    const recommendedMoviesContainer = document.getElementById('recommended-grid');
    const currentMoviVideoUrl = JSON.parse(localStorage.getItem('currentMovie'));

    if (currentMovie) {
      // Populate movie details and breadcrumb
      document.getElementById('movie-title').textContent = currentMovie.movie_name;
      document.getElementById('breadcrumb-movie-name').textContent = currentMovie.movie_name;
      document.getElementById('movie-description').textContent = currentMovie.description;

      // Correctly format the YouTube URL if it's not already in the embed format
      let embedUrl = currentMovie.details.video_url;
      if (embedUrl.includes('watch?v=')) {
        embedUrl = embedUrl.replace('watch?v=', 'embed/');
      }

      // Create an iframe element for the video
      const videoContainer = document.getElementById('video-container');
      const iframe = document.createElement('iframe');
      iframe.width = '800';
      iframe.height = '450';
      iframe.src = embedUrl;
      iframe.frameBorder = '0';
      iframe.allow = 'accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture';
      iframe.allowFullscreen = true;
      videoContainer.appendChild(iframe);

      // Load recommended movies (excluding the current one)
      fetch('movies.json')
        .then(response => response.json())
        .then(data => {
          const allMovies = data.movies.filter(movie => movie.id !== currentMovie.id);

          // Randomly select up to 10 movies
          const recommendedMovies = allMovies.sort(() => 0.5 - Math.random()).slice(0, 10);

          recommendedMovies.forEach(movie => {
            const movieCard = document.createElement('div');
            movieCard.classList.add('movie-card');
            movieCard.innerHTML = `
              <img src="${movie.image_url}" alt="${movie.movie_name}" class="movie-card-img">
              <h3>${movie.movie_name}</h3>
              <p>Rating: ${movie.rating}/5</p>
              <button onclick="viewMovie(${movie.id})">View Details</button>
            `;
            recommendedMoviesContainer.appendChild(movieCard);
          });
        });
    } else {
      document.body.innerHTML = '<p>No movie selected. Please go back and select a movie.</p>';
    }

    // View details for a recommended movie
    function viewMovie(movieId) {
      fetch('movies.json')
        .then(response => response.json())
        .then(data => {
          const movie = data.movies.find(m => m.id === movieId);
          if (movie) {
            localStorage.setItem('currentMovie', JSON.stringify(movie));
            window.location.href = 'video.html';
          }
        });
    }
  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    .navBar {
      background-color: #222;
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 20px;
    }

    .header a {
      color: white;
      margin: 0 10px;
      text-decoration: none;
    }

    #movie-header h1 {
      text-align: center;
      margin-top: 20px;
    }

    #breadcrumbs {
      margin: 10px 20px;
    }

    #breadcrumbs a {
      color: #007bff;
      text-decoration: none;
    }

    #breadcrumbs span {
      color: #555;
    }

    #video-section {
      display: flex;
      justify-content: center;
      margin: 20px 0;
    }

    #movie-details {
      margin: 20px;
    }

    #recommended-movies {
      margin: 20px;
    }

    .recommended-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
    }

    .movie-card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
    }

    .movie-card-img {
      max-width: 100%;
      border-radius: 8px;
    }

    footer {
      background-color: #222;
      color: white;
      text-align: center;
      padding: 10px;
    }
  </style>
</body>
</html>
